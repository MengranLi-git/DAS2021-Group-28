---
title: "Properties that influence wine score"
author: 'Group 28: Aishwin Tikku, Mengran Li, Steven Kwok, Shaoquan Li, Shuning Li'

output:
  pdf_document:
    latex_engine: pdflatex
    number_sections: no
  html_document:
    df_print: paged
fig_caption: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, eval = TRUE, warning = FALSE, message = FALSE, comment = NA, fig.pos = 'H')

options(digits = 4)
```


```{r libraries, message=FALSE, warning=FALSE}
library(tidyverse)
library(ggplot2)
library(tidymodels)
library(GGally)
library(car)
library(sjPlot)
library(skimr)
library(kableExtra)
library(knitr)
library(janitor)
```


``` {r echo = FALSE, eval = TRUE, warning = FALSE, message = FALSE}
Data <- read.csv("dataset28.csv")
```


# Introduction {#sec:Intro}

Wine is an alcoholic drink, produced by various kinds of fermented fruits like grapes, apple or blueberry. There are four kinds of wines, involving white wine, red wine, rose wine and sparking wine. The difference of wines depends on various kinds of factors, including type of grapes, soil status, and province state. We analysis a data set from the Wine Enthusiast, a famous American wine provider, in this project. Thousands of wines were rated in this data set, where wine with points lower than 80 were filtered.

The aim of our project is discovering properties leading the occurrence of high rated wine, the wine with points larger than 90. The first session visualize the structure, properties, as well as correlations inside the dataset. We, next in order, analysis factors of wine, leading high ranking, thorough the best generalized linear model. Finally, we conclude the entire analysis, as well as discussing what we can do in the future.

# Data Structure and Visualisation {#sec:DSV}
The whole data set has 7 factors and 2000 observations.
```{r echo=FALSE, eval=TRUE, message=FALSE,warning=FALSE}

Data <- Data[, -1]
Data$country <- as.factor(Data$country)
Data$province <- as.factor(Data$province)
Data$title <- as.factor(Data$title)
Data$variety <- as.factor(Data$variety)
Data$winery <- as.factor(Data$winery)

# Group by points, those greater than 90 are pass, others are fail
Data <- Data %>% mutate(score = ifelse(points > 90, "Pass", "Fail"))
Data$score <- as.factor(Data$score)
```


```{r his, fig.width=6, fig.height=4, fig.align='center',echo = FALSE, eval = TRUE, warning = FALSE, message = FALSE, fig.cap="\\label{fig:hist} Histogram of Price and Points"}


#### descriptive statistics ####
Data[, c(2, 3)] %>%
  gather(key = "variable", value = "value") %>%
  ggplot() +
  geom_histogram(aes(x = value), fill = "#80C687", color = "#80C687", alpha = 0.8) +
  facet_wrap(~variable, scales = "free")

```

```{r boxplot, eval=TRUE, echo=FALSE, fig.align="center", fig.cap="\\label{fig:box} Boxplot of points by country", message=FALSE, warning=FALSE, out.width='75%', fig.pos='H'}

ggplot(data = Data) +
  geom_boxplot(aes(points, country))

```

```{r echo=FALSE,eval=TRUE,message=FALSE,warning=FALSE}
 Data %>%
  tabyl(country,score)%>%
  adorn_percentages()%>%
  adorn_pct_formatting()%>%
  adorn_ns()

```


```{r echo=FALSE,eval=TRUE,message=FALSE,warning=FALSE}


# chi square test
chisq.test(Data$country, Data$score)

```



```{r dplot, eval=TRUE, echo=FALSE, fig.align="center", fig.cap="\\label{fig:dplot} Density plot by score", message=FALSE, warning=FALSE, out.width='75%', fig.pos='H'}


ggplot(data = Data) +
  geom_density(aes(price, group = score, fill = score))

```







# Methodology {#sec:FDA}

```{r glm, echo=FALSE, eval=TRUE, message=FALSE, warning=FALSE}
#### glm model ####
fit <- glm(score ~ price + country,
  data = Data,
  family = binomial(link = "logit"))
s <- fit %>% summary()
kable(s$coefficients, caption = "Summary Statistics of GLM Model")
```
New Zealand and Italy are significantly different from others


GLM MOdel for New Zealand
```{r nz, echo=FALSE, eval=TRUE, message=FALSE, warning=FALSE, }

NewZealand <- Data %>% filter(country == "New Zealand")

nz <- glm(score ~ price + province + variety,
  data = NewZealand,
  family = binomial(link = "logit"))
nzland <- nz %>% 
  summary()

kable(round(nzland$coefficients,4), caption = "GLM Model for New Zealand")

```

GLM Model for Italy
```{r itly, echo=FALSE, eval=TRUE, message=FALSE, warning=FALSE}

Italy <- Data %>% filter(country == "Italy")

it <- glm(score ~ price + province + variety,
  data = Italy,
  family = binomial(link = "logit"))
itly <- it %>% 
  summary()

kable(round(itly$coefficients,4), caption = "GLM Model for Italy")
  
```



GLM Model & Predicted Values Plot based on only Price
```{r model, echo=FALSE,eval=TRUE, message=FALSE, warning=FALSE, fig.cap="\\label{fig:pred} Pass Probability Plot by Price", message=FALSE, warning=FALSE, out.width='75%', fig.pos='H'}

# model with only price

fit1 <- glm(score ~ price,
  data = Data,
  family = binomial(link = "logit"))

plot_model(fit1,
  type = "pred", title = "",
  axis.title = c("price", "Probability of pass"))
```

# Coclusion and Future Work {#sec:CFW}

For discovering factors affecting the quality of wine more accurately, we can combine multiple data sets with details of Wineries. Different model, additionally, will be trained and tested for selecting the best model. The targeted model will be neural network, a self-learning model which can handle large amount of new data.

# Reference {#sec:Ref}

 Christina, https://cellar.asia/wine/what-is-wine/